<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/indexLayout}">

<th:block layout:fragment="script">
    <script th:inline="javascript">
        $(document).on("click", ".goResult", function() {
            let mbti = $("#mbtiRes").val();
            //let header = $("meta[name='_csrf_header']").attr('content');
            //let token = $("meta[name='_csrf']").attr('content');

            console.log("before: " + mbti);

            if(mbti == "ESTJ") {
                mbti = "MALBAC";
            } else if(mbti == "INFP") {
                mbti = "MERLOT";
            } else if(mbti == "ENTP") {
                mbti = "ZINFANDEL";
            } else if(mbti == "ESFP") {
                mbti = "CABERNET_SAUVIGNON";
            } else if(mbti == "ENFP") {
                mbti = "ETC";
            } else if(mbti == "ENFJ") {
                mbti = "CABERNET_SAUVIGNON";
            } else if(mbti == "ESTP") {
                mbti = "ETC";
            } else if(mbti == "INTJ") {
                mbti = "TEMPRANILLO";
            } else if(mbti == "INTP") {
                mbti = "RIESLING";
            } else if(mbti == "ISFJ") {
                mbti = "PRIMITIVO";
            } else if(mbti == "ENTJ") {
                mbti = "PINOT_NOIR";
            } else if(mbti == "ISFP") {
                mbti = "BLEND";
            } else if(mbti == "ESFJ") {
                mbti = "SAUVIGNON_BLANC";
            } else if(mbti == "ISTJ") {
                mbti = "MERLOT";
            } else if(mbti == "INFJ") {
                mbti = "SHIRAZ";
            } else if(mbti == "ISTP") {
                mbti = "BLEND";
            }

            console.log("after: " + mbti);

            $.ajax({
                url: "/searchMbtiItem",
                type: "GET",
                data : {"mbti": mbti},
                success: function(data) {
                    console.log(data);
                    $(".goResult").hide();

                    let itemHtml = "";
                    for(let i = 0; i < data.length; i++) {
                        itemHtml += "<li class='search-item'>";
                        itemHtml += "    <div class='products-entry'>";
                        itemHtml += "        <a href='/item/" + data[i].id  + "' class='info-link'></a>";
                        itemHtml += "        <div class='products-thumb'>";
                        itemHtml += "            <div class='product-image'>";
                        itemHtml += "                <img src='" + data[i].imgUrl + "' alt='" + data[i].id + "'>";
                        itemHtml += "            </div>";
                        itemHtml += "        </div>";
                        itemHtml += "        <div class='products-content'>";
                        itemHtml += "            <div class='product-subname'>" + data[i].winary + "</div>";
                        itemHtml += "            <div class='product-name txt-line-2'>" + data[i].itemNm + "</div>";
                        itemHtml += "        </div>";
                        itemHtml += "    </div>";
                        itemHtml += "</li>";
                    }

                    $("#mbtiResultBody").append(itemHtml);
                },
                error: function(xhr, status, error) {
                    console.error("Ajax 에러:", error);
                }
            });
        });

    </script>
</th:block>

<div layout:fragment="content" class="main-container">
    <section class="main-banner">
        <div class="banner-wrap">
            <img th:src="@{/img/main-banner.jpg}" alt="">
            <div class="banner-btn">
                <a href="/list">SHOP WINES</a>
            </div>
        </div>
    </section>

    <section class="section-com container">
        <div class="product-wrapper sale-product">
            <a href="#" class="product-more-btn">SEE ALL</a>
            <div class="heading-box">
                <h2 class="heading-tit">타임세일</h2>
                <div class="counter-wrapper">
                    <div class="days hide" data-days="00">
                        <div class="number-wrapper">
                            <span class="number">00</span>
                        </div>
                        <div class="ref-wrapper">days</div>
                    </div>
                    <div class="hours" data-hours="03">
                        <div class="number-wrapper">
                            <span class="number">03</span>
                        </div>
                        <div class="ref-wrapper">Hours</div>
                    </div>
                    <span class="dots">:</span>
                    <div class="minutes" data-minutes="59">
                        <div class="number-wrapper">
                            <span class="number">45</span>
                        </div>
                        <div class="ref-wrapper">Mins</div>
                    </div>
                    <span class="dots">:</span>
                    <div class="seconds" data-seconds="02">
                        <div class="number-wrapper">
                            <span class="number">11</span>
                        </div>
                        <div class="ref-wrapper">Secs</div>
                    </div>
                </div>
            </div>
            <div class="content-box">
                <div class="swiper-container">
                    <div class="swiper-wrapper">
                        <div class="swiper-slide">
                            <div class="products-entry">
                                <a href="/item/detail" class="info-link"></a>
                                <div class="products-thumb">
                                    <div class="product-image">
                                        <img th:src="@{/img/wine-1.png}" alt="">
                                    </div>
                                    <div class="add-cart-btn">ADD TO CART</div>
                                </div>
                                <div class="products-content">
                                    <div class="product-subname">Poggio Scalette</div>
                                    <div class="product-name txt-line-2">Il Carbonaione Alta Valle della Greve 2011 750ml</div>
                                    <div class="product-price">
                                        <del class="origin-price" aria-hidden="true">
                                            <span class="amount"><bdi>250,000</bdi>원</span>
                                        </del>
                                        <div class="current-price">
                                            <span class="amount"><bdi>175,000</bdi>원</span>
                                        </div>
                                        <div class="per">30%</div>
                                    </div>
                                    <div class="product-rate">
                                        <span class="star-review-icon" th:style="'background-image: url(/img/star-icon-on.png)'">0.0 (0)</span>
                                    </div>
                                    <div class="wishitem-btn">
                                        <span class="like-icon material-symbols-outlined">favorite</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="swiper-slide">
                            <div class="products-entry">
                                <a href="/item/detail" class="info-link"></a>
                                <div class="products-thumb">
                                    <div class="product-image">
                                        <img th:src="@{/img/wine-2.png}" alt="">
                                    </div>
                                    <div class="add-cart-btn">ADD TO CART</div>
                                </div>
                                <div class="products-content">
                                    <div class="product-subname">Hardys</div>
                                    <div class="product-name txt-line-2">HRB Shiraz 2008 750ml</div>
                                    <div class="product-price">
                                        <del class="origin-price" aria-hidden="true">
                                            <span class="amount"><bdi>90,000</bdi>원</span>
                                        </del>
                                        <div class="current-price">
                                            <span class="amount"><bdi>63,000</bdi>원</span>
                                        </div>
                                        <div class="per">18%</div>
                                    </div>
                                    <div class="product-rate">
                                        <span class="star-review-icon" th:style="'background-image: url(/img/star-icon-on.png)'">0.0 (0)</span>
                                    </div>
                                    <div class="wishitem-btn">
                                        <span class="like-icon material-symbols-outlined">favorite</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="swiper-slide">
                            <div class="products-entry">
                                <a href="/item/detail" class="info-link"></a>
                                <div class="products-thumb">
                                    <div class="product-image">
                                        <img th:src="@{/img/wine-3.png}" alt="">
                                    </div>
                                    <div class="add-cart-btn">ADD TO CART</div>
                                </div>
                                <div class="products-content">
                                    <div class="product-subname">Château Couhdiv-Lurton</div>
                                    <div class="product-name txt-line-2">Pessac-Léognan Blanc (Grand Cru Classé de Graves) 2011</div>
                                    <div class="product-price">
                                        <del class="origin-price" aria-hidden="true">
                                            <span class="amount"><bdi>132,000</bdi>원</span>
                                        </del>
                                        <div class="current-price">
                                            <span class="amount"><bdi>105,600</bdi>원</span>
                                        </div>
                                        <div class="per">22%</div>
                                    </div>
                                    <div class="product-rate">
                                        <span class="star-review-icon" th:style="'background-image: url(/img/star-icon-on.png)'">0.0 (0)</span>
                                    </div>
                                    <div class="wishitem-btn">
                                        <span class="like-icon material-symbols-outlined">favorite</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="swiper-slide">
                            <div class="products-entry">
                                <a href="/item/detail" class="info-link"></a>
                                <div class="products-thumb">
                                    <div class="product-label sold-out">품절</div>
                                    <div class="product-image">
                                        <img th:src="@{/img/wine-4.png}" alt="">
                                    </div>
                                    <div class="add-cart-btn">ADD TO CART</div>
                                </div>
                                <div class="products-content">
                                    <div class="product-subname">Château Rabaud-Promis</div>
                                    <div class="product-name txt-line-2">Sauternes (Premier Grand Cru Classé) 1955</div>
                                    <div class="product-price">
                                        <del class="origin-price" aria-hidden="true">
                                            <span class="amount"><bdi>468,000</bdi>원</span>
                                        </del>
                                        <div class="current-price">
                                            <span class="amount"><bdi>411,840</bdi>원</span>
                                        </div>
                                        <div class="per">15%</div>
                                    </div>
                                    <div class="product-rate">
                                        <span class="star-review-icon" th:style="'background-image: url(/img/star-icon-on.png)'">0.0 (0)</span>
                                    </div>
                                    <div class="wishitem-btn">
                                        <span class="like-icon material-symbols-outlined">favorite</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="swiper-btn swiper-button-prev" th:style="'background-image: url(/img/slide-arrow.png)'"></div>
                <div class="swiper-btn swiper-button-next" th:style="'background-image: url(/img/slide-arrow.png)'"></div>
                <div class="swiper-pagination"></div>
            </div>
        </div>
    </section>

    <section class="section-com container">
        <div class="mbti-wrap">
            <input type="hidden" id="EI" value="0">
            <input type="hidden" id="SN" value="0">
            <input type="hidden" id="TF" value="0">
            <input type="hidden" id="JP" value="0">
            <input type="hidden" id="mbtiRes" value="">

            <h2 class="title">와인 MBTI 테스트</h2>

            <!-- progressbar -->
            <div class="mbti-progress">
                <div class="progress-text"></div>
                <div class="progress-bar"><span></span></div>
            </div>

            <article class="start-page">
                <p>내 성향별 추천 와인 알아보기</p>
                <button type="button" onclick="testStart();">테스트 시작</button>
            </article>

            <article class="question-page">
                <h2 id="title"></h2>
                <input type="hidden" id="type" value="EI">
                <button id="A" type="button"></button>
                <button id="B" type="button"></button>
            </article>

            <article>
                <ul id="mbtiResultBody" class="mbtiItemList">

                </ul>
            </article>
        </div>
    </section>
</div>
</html>